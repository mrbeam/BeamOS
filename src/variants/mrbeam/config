#!/bin/sh
# variant mrbeam, flavor default: override hostname & custom config setting

export DIST_NAME=BeamOS
export BASE_OVERRIDE_HOSTNAME=MrBeam-XXXX
export BASE_IMAGE_ENLARGEROOT=1200
# Add the beamos module
export MODULES="base(raspicam, network, disable-services(dev-libs(octopi, beamos)), password-for-sudo)"

export OCTOPI_OCTOPRINT_REPO_BUILD=https://github.com/mrbeam/OctoPrint.git
export OCTOPI_OCTOPRINT_REPO_SHIP=https://github.com/mrbeam/OctoPrint.git
export OCTOPI_OCTOPRINT_REPO_BRANCH=mrbeam2-stable

if [ "$1" = "dev" -o "$1" = "develop" ]; then
    echo "BUILDING DEV FLAVOR"
    export OCTOPI_OCTOPRINT_REPO_BRANCH=develop
    export BEAMOS_MRBEAMPLUGIN_REPO_BRANCH=develop
    export BEAMOS_MRBEAMIOBEAM_REPO_BRANCH=develop
    export BEAMOS_MRBEAMLED_REPO_BRANCH=develop
    export BEAMOS_USBMOUNTMANAGER_REPO_BRANCH=develop
    export BEAMOS_FINDMYMRBEAM_PLUGIN_REPO_BRANCH=develop
else
    echo "BUILDING STABLE FLAVOR"
fi

# disable unnecessary stuff
export OCTOPI_INCLUDE_OCTOPIPANEL=no
export OCTOPI_INCLUDE_CURAENGINE=no
export OCTOPI_INCLUDE_MJPGSTREAMER=no
export OCTOPI_INCLUDE_WIRINGPI=no
export OCTOPI_INCLUDE_FFMPEG_HLS=no

# Fix - only python2 compatible for now:
export OCTOPI_PYTHON_VERSION=python2
# Add dev repos to build up the MrBeam dependencies - Will not be kept in the image.
export DEV_LIBS_EXTRA="python2-dev"
# dev - enable repos little by little
export BEAMOS_INCLUDE_MOUNTMANAGER=no
export BEAMOS_INCLUDE_NETCONNECTD=no
export BEAMOS_INCLUDE_IOBEAM=no
export BEAMOS_DEV=no
